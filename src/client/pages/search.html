<style style="display: none;">
  .search{
  }
</style>
<<document.title = "TechnoViper - search" >>
<div class="search">
  <<<
    yield include('../body/partial/input.html', {
      value: '',
      placeholder: 'Search...',
    });
    yield include('../body/partial/button.html', {
      label: 'Search',
      href: '#',
    });
  >>>
  <<
    vars.input = document.querySelector('.search .input');
    vars.button = document.querySelector('.search .button');
  >>
  <<
    vars.button.onclick = (e) => {
      e.preventDefault();
      history.pushState(null, null, '#' + vars.input.value.replace(/ /g, '-'));
      watch.searchQuery = vars.input.value;
    }
    vars.button.click();
    consts.searchDelay = 2000;
    vars.lastKeyup = 0;
    vars.input.onkeyup = (e) => {
      vars.lastKeyup++;
      if(e.key == 'Enter') vars.button.click();
      else setTimeout((lku) => {
        if(vars.lastKeyup == lku) vars.button.click();
      }, consts.searchDelay, vars.lastKeyup);
    }
  >>
  <<
    var query = watch.hash.replace(/-/g, ' ');
    if(query){
      vars.input.value = query;
      vars.button.click();
    }
  >>
  <<
    var search = watch.searchQuery;
    if(search == '') return;
    var ids = JSON.parse((await include('../body/partial/card-list.html', {
      opr: 'search',
      tags: [search],
      excl: null,
      max: 1000,
    })).text);
    yield include('/body/partial/mosaic/full.html', {
      ids: ids,
    });
  >>
</div>
