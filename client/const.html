<< consts.lang = '<<<yield consts.lang>>>' >>
<!-- dynamic watch.url and watch.path definitions -->
<!-- https://stackoverflow.com/questions/5817505/is-there-any-method-to-get-the-url-without-query-string -->
<< history.scrollRestoration = 'manual' >>
<< vars.firstLoad = 0; >>
<< vars.url = null; vars.urlh = null; >>
<<
  utils.redirect = async (e, popstate = false) => {
    e.preventDefault();
    //https://stackoverflow.com/questions/14721388/how-to-get-the-exact-href-value-only-without-their-domain
    //https://stackoverflow.com/questions/50149925/click-event-target-gives-element-or-its-child-not-parent-element
    var url = e.currentTarget.pathname; // || '/';
    var urlh = e.currentTarget.hash.replace(/^#/, '');
    var urlChanged = vars.url != url;
    var urlhChanged = vars.urlh != urlh;

    if(!popstate && urlChanged){
      if(urlh && urlhChanged) history.pushState(null, null, url + '#' + urlh);
      else history.pushState(null, null, url);
    }
    window.scrollTo({top: 0, left: 0, behavior: 'smooth'});

    watch.url = vars.url = url;
    watch.urlh = vars.urlh = urlh;
    if(vars.firstLoad > 0) await utils.sleep(500);
    if(urlChanged) watch.path = url.split('?')[0].replace(/^\//, '').split('/');
    if(urlhChanged) watch.hash = urlh;

    vars.firstLoad++;
  }
>>
<<
  var func = (e) => {
    utils.redirect({
      preventDefault: () => null,
      currentTarget: window.location,
    }, true);
  }
  func();
  //window.addEventListener('pushstate', func);
  window.addEventListener('popstate',  func); //function(e){ console.log(e.preventDefault); }
>>
